<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Management - Markan Cafe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="../css/responsive.css">
</head>
<body class="admin-body">
    <div class="admin-wrapper">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <img src="../assets/images/logo.png" alt="Markan Cafe" onerror="this.src='https://via.placeholder.com/60x60/8B4513/FFD700?text=MC'">
                <h3>Markan Cafe</h3>
                <p>Admin Panel</p>
            </div>
            
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="dashboard.html"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
                    <li><a href="menu-management.html" class="active"><i class="fas fa-utensils"></i> <span>Menu Management</span></a></li>
                    <li><a href="orders.html"><i class="fas fa-clipboard-list"></i> <span>Orders</span></a></li>
                    <li><a href="reservations.html"><i class="fas fa-calendar-check"></i> <span>Reservations</span></a></li>
                    <li><a href="users.html"><i class="fas fa-users"></i> <span>Users</span></a></li>
                    <li><a href="billing.html"><i class="fas fa-receipt"></i> <span>Billing</span></a></li>
                    <li><a href="profile.html"><i class="fas fa-user-cog"></i> <span>Profile</span></a></li>
                    <li><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Top Header -->
            <header class="admin-top-header">
                <div class="header-search">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchMenu" placeholder="Search menu items...">
                </div>
                <div class="header-user">
                    <div class="header-notifications">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </div>
                    <div class="header-profile">
                        <img src="../assets/images/team/admin.jpg" alt="Admin" onerror="this.src='https://via.placeholder.com/40x40/8B4513/FFD700?text=Admin'">
                        <div class="profile-info">
                            <h4 id="adminName">Admin User</h4>
                            <p>Administrator</p>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Header -->
            <div class="page-header">
                <h1>Menu Management</h1>
                <button class="btn btn-primary" onclick="openAddModal()">
                    <i class="fas fa-plus"></i> Add New Item
                </button>
            </div>

            <!-- Category Filter -->
            <div style="margin-bottom: 20px;">
                <select id="categoryFilter" class="form-control" style="width: 200px; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="all">All Categories</option>
                    <option value="beverages">Beverages</option>
                    <option value="meals">Meals</option>
                    <option value="snacks">Snacks</option>
                    <option value="desserts">Desserts</option>
                </select>
            </div>

            <!-- Menu Items Table -->
            <div class="table-responsive">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Description</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="menuItemsTable">
                        <!-- Will be populated by JS -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Add/Edit Item Modal -->
    <div class="modal" id="itemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Add Menu Item</h3>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="itemForm">
                    <div class="form-group">
                        <label for="itemName">Item Name</label>
                        <input type="text" id="itemName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemCategory">Category</label>
                        <select id="itemCategory" required>
                            <option value="beverages">Beverages</option>
                            <option value="meals">Meals</option>
                            <option value="snacks">Snacks</option>
                            <option value="desserts">Desserts</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="itemPrice">Price ($)</label>
                            <input type="number" id="itemPrice" step="0.01" min="0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="itemStatus">Status</label>
                            <select id="itemStatus">
                                <option value="true">Available</option>
                                <option value="false">Out of Stock</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemDescription">Description</label>
                        <textarea id="itemDescription" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="itemImage">Image URL</label>
                        <input type="text" id="itemImage" placeholder="https://example.com/image.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label class="checkbox">
                            <input type="checkbox" id="itemPopular"> Mark as Popular
                        </label>
                    </div>
                    
                    <input type="hidden" id="itemId">
                </form>
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveItem()">Save Item</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>Confirm Delete</h3>
                <button class="modal-close" onclick="closeDeleteModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this item? This action cannot be undone.</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <script src="../js/main.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        // Check admin authentication
        if (!Auth.requireAdmin()) {
            window.location.href = '../login.html';
        }

        let menuItems = [];
        let currentItemId = null;

        document.addEventListener('DOMContentLoaded', function() {
            updateAdminName();
            loadMenuItems();
            setupEventListeners();
        });

        function updateAdminName() {
            const user = Auth.getCurrentUser();
            if (user) {
                document.getElementById('adminName').textContent = user.name;
            }
        }

        function loadMenuItems() {
            // Mock data - replace with actual API call
            menuItems = [
                { id: 1, name: 'Ethiopian Coffee', category: 'beverages', price: 4.50, description: 'Traditional Ethiopian coffee ceremony', image: 'assets/images/menu/beverages/ethiopian-coffee.jpg', popular: true, status: true },
                { id: 2, name: 'Macchiato', category: 'beverages', price: 3.75, description: 'Espresso with steamed milk', image: 'assets/images/menu/beverages/macchiato.jpg', popular: false, status: true },
                { id: 3, name: 'Doro Wat', category: 'meals', price: 12.99, description: 'Spicy Ethiopian chicken stew', image: 'assets/images/menu/meals/doro-wat.jpg', popular: true, status: true },
                { id: 4, name: 'Kitfo', category: 'meals', price: 14.50, description: 'Minced raw beef with spices', image: 'assets/images/menu/meals/kitfo.jpg', popular: true, status: true },
                { id: 5, name: 'Sambusa', category: 'snacks', price: 3.50, description: 'Fried pastry filled with lentils', image: 'assets/images/menu/snacks/sambusa.jpg', popular: true, status: true },
                { id: 6, name: 'Honey Bread', category: 'desserts', price: 4.99, description: 'Traditional sweet bread', image: 'assets/images/menu/desserts/honey-bread.jpg', popular: false, status: false }
            ];
            
            displayMenuItems(menuItems);
        }

        function displayMenuItems(items) {
            const tbody = document.getElementById('menuItemsTable');
            tbody.innerHTML = items.map(item => `
                <tr>
                    <td>
                        <img src="${item.image}" alt="${item.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;" onerror="this.src='https://via.placeholder.com/50x50/8B4513/FFD700?text=Food'">
                    </td>
                    <td>${item.name} ${item.popular ? '<span class="badge" style="background: #FFD700; color: #8B4513; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; margin-left: 5px;">Popular</span>' : ''}</td>
                    <td>${item.category}</td>
                    <td>$${item.price.toFixed(2)}</td>
                    <td>${item.description.substring(0, 30)}...</td>
                    <td><span class="status-badge ${item.status ? 'completed' : 'cancelled'}">${item.status ? 'Available' : 'Out of Stock'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit" onclick="editItem(${item.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteItem(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function openAddModal() {
            currentItemId = null;
            document.getElementById('modalTitle').textContent = 'Add Menu Item';
            document.getElementById('itemForm').reset();
            document.getElementById('itemId').value = '';
            document.getElementById('itemModal').classList.add('active');
        }

        function editItem(id) {
            const item = menuItems.find(i => i.id === id);
            if (!item) return;

            currentItemId = id;
            document.getElementById('modalTitle').textContent = 'Edit Menu Item';
            document.getElementById('itemName').value = item.name;
            document.getElementById('itemCategory').value = item.category;
            document.getElementById('itemPrice').value = item.price;
            document.getElementById('itemDescription').value = item.description;
            document.getElementById('itemImage').value = item.image || '';
            document.getElementById('itemPopular').checked = item.popular || false;
            document.getElementById('itemStatus').value = item.status.toString();
            document.getElementById('itemId').value = item.id;
            
            document.getElementById('itemModal').classList.add('active');
        }

        function saveItem() {
            const name = document.getElementById('itemName').value;
            const category = document.getElementById('itemCategory').value;
            const price = parseFloat(document.getElementById('itemPrice').value);
            const description = document.getElementById('itemDescription').value;
            const image = document.getElementById('itemImage').value;
            const popular = document.getElementById('itemPopular').checked;
            const status = document.getElementById('itemStatus').value === 'true';

            if (!name || !category || !price || !description) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            if (currentItemId) {
                // Update existing item
                const index = menuItems.findIndex(i => i.id === currentItemId);
                if (index !== -1) {
                    menuItems[index] = {
                        ...menuItems[index],
                        name, category, price, description, image, popular, status
                    };
                    showNotification('Item updated successfully', 'success');
                }
            } else {
                // Add new item
                const newId = Math.max(...menuItems.map(i => i.id), 0) + 1;
                menuItems.push({
                    id: newId,
                    name, category, price, description, image, popular, status
                });
                showNotification('Item added successfully', 'success');
            }

            displayMenuItems(menuItems);
            closeModal();
        }

        function deleteItem(id) {
            currentItemId = id;
            document.getElementById('deleteModal').classList.add('active');
        }

        function confirmDelete() {
            if (currentItemId) {
                menuItems = menuItems.filter(i => i.id !== currentItemId);
                displayMenuItems(menuItems);
                showNotification('Item deleted successfully', 'success');
                closeDeleteModal();
            }
        }

        function closeModal() {
            document.getElementById('itemModal').classList.remove('active');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.remove('active');
        }

        function setupEventListeners() {
            // Search functionality
            document.getElementById('searchMenu').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filtered = menuItems.filter(item => 
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.description.toLowerCase().includes(searchTerm)
                );
                displayMenuItems(filtered);
            });

            // Category filter
            document.getElementById('categoryFilter').addEventListener('change', function(e) {
                const category = e.target.value;
                if (category === 'all') {
                    displayMenuItems(menuItems);
                } else {
                    const filtered = menuItems.filter(item => item.category === category);
                    displayMenuItems(filtered);
                }
            });
        }

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', (e) => {
            e.preventDefault();
            Auth.logout();
        });
    </script>
</body>
</html>